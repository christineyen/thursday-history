<!-- ONLY USED FOR COMPARISON AT THIS POINT - all actual logic should now live inside thursdays/templates/thursday.mako -->

<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

  <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>

<script type="text/javascript">
  var geocoder;
  var map;
  var markers = [];

  var tempPast = [
    { address: '565 Green St',
      date: new Date('June 25, 2010') },
    { address: '3121 16th Street',
      date: new Date('June 18, 2010') },
    { address: '354 11th St',
      date: new Date('June 11, 2010') },
    { address: '762 Divisadero St',
      date: new Date('June 4, 2010') },
    { address: '2124 Market St',
      date: new Date('May 28, 2010') }];

  function initialize() {
    geocoder = new google.maps.Geocoder();
    var latlng = new google.maps.LatLng(37.78, -122.445);
    var myOptions = {
      zoom: 13,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      navigationControl: true,
      scaleControl: true,
    };
    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

    for (var i = 0; i < tempPast.length; i++) {
      codeAddress(tempPast[i]);
    }
  }

  function codeAddress(tempPastObject) {
    if (geocoder) {
      geocoder.geocode( { 'address': tempPastObject.address + ', San Francisco, CA'}, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          tempPastObject['location'] = results[0].geometry.location;
          markers.push(getMarker(tempPastObject.address, results[0].geometry.location));
        } else {
          alert("Geocode was not successful for the following reason: " + status);
        }
      });
    }
  }

  function getMarker(address, location) {
    return new google.maps.Marker({
      map: map,
      position: location,
      title: address,
    });
  }

</script>
<script>
$(document).ready(function() {
  var maxValue = tempPast.length - 1;
    $('#slider').slider({
        min: 0,
        max: maxValue,
        values: [0, maxValue],
        start: function(e,ui){
          console.log("starting");
        },
        stop: function(e,ui){
          for (var i = 0; i < markers.length; i++) {
            markers[i].setMap(null);
            delete(markers[i]);
          }
          markers = [];

          for (var i = ui.values[0]; i <= ui.values[1]; i++) {
            if (tempPast[i].location) {
              markers.push(getMarker(tempPast[i].address, tempPast[i].location));
            } else {
              codeAddress(tempPast[i].address);
            }
          }
        },
        slide: function(e,ui){
        }
    });
  });
</script>
<style type="text/css">
  <!--
    #map_canvas {
      width: 800px;
      height: 500px;
    }
    #slider {
      width: 800px;
    }
  //-->
</style>
</head>
<body onload="initialize()">
  <div id="map_canvas"></div>
  <div id="slider"></div>
</body>
</html>
